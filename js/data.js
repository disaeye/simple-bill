const DataModule=function(){const t={"é¤é¥®":"ðŸœ","äº¤é€š":"ðŸš—","è´­ç‰©":"ðŸ›ï¸","å¨±ä¹":"ðŸŽ®","æ•™è‚²":"ðŸ“š","åŒ»ç–—":"ðŸ¥","å±…ä½":"ðŸ ","é€šè®¯":"ðŸ“±","æŠ•èµ„":"ðŸ’°","å…¶ä»–":"ðŸ“¦"},e={"é¤é¥®":"#E17055","äº¤é€š":"#00B894","è´­ç‰©":"#0984E3","å¨±ä¹":"#6C5CE7","æ•™è‚²":"#FDCB6E","åŒ»ç–—":"#E84393","å±…ä½":"#00CEC9","é€šè®¯":"#2D3436","æŠ•èµ„":"#A29BFE","å…¶ä»–":"#74B9FF"};let n=[],a={"é¤é¥®":["æ—©é¤","åˆé¤","æ™šé¤","å¤œå®µ","é›¶é£Ÿ","å¤–å–","é¥®å“"],"äº¤é€š":["å…¬äº¤","åœ°é“","æ‰“è½¦","åŠ æ²¹","åœè½¦","é«˜é“","é£žæœº"],"è´­ç‰©":["æ—¥ç”¨å“","æœè£…","æ•°ç ","å®¶ç”µ","ç¾Žå¦†","å®¶å±…"],"å¨±ä¹":["ç”µå½±","æ¸¸æˆ","å¥èº«","æ—…æ¸¸","èšä¼š","éŸ³ä¹"],"æ•™è‚²":["åŸ¹è®­","ä¹¦ç±","è¯¾ç¨‹","è€ƒè¯•"],"åŒ»ç–—":["è¯å“","é—¨è¯Š","ä½“æ£€","ç‰™ç§‘"],"å±…ä½":["æˆ¿ç§Ÿ","æ°´ç”µ","ç‰©ä¸š","ç»´ä¿®"],"é€šè®¯":["æ‰‹æœºè´¹","å®½å¸¦","ç”µè¯"],"æŠ•èµ„":["è‚¡ç¥¨","åŸºé‡‘","ç†è´¢"],"å…¶ä»–":[]},r={...t},o={...e},s=!1;function c(t){return t>0?"income":"expense"}function u(t){let e=0,n=0,a=0;return t.forEach(t=>{const r=t.type;"expense"===r?e+=Math.abs(t.amount):"refund"===r?n+=Math.abs(t.amount):"income"===r&&(a+=t.amount)}),{totalExpense:e,totalRefund:n,totalIncome:a,netExpense:e-n,count:t.length}}function i(t){const e=new Date(t);e.setHours(0,0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));const n=new Date(e.getFullYear(),0,1);return Math.ceil(((e-n)/864e5+1)/7)}function g(t,e){const n=new Date(t,0,1+7*(e-1)),a=n.getDay(),r=new Date(n);a<=4?r.setDate(n.getDate()-n.getDay()+1):r.setDate(n.getDate()+8-n.getDay());const o=new Date(r);return o.setDate(r.getDate()+6),{start:r,end:o}}return{loadCategoriesFromFile:async function(){try{const n=await fetch("data/categories.json");if(n.ok){const c=await n.json();c.categories&&(a=c.categories),c.icons&&(r={...t,...c.icons}),c.colors&&(o={...e,...c.colors}),s=!0}}catch(t){console.log("ä»Ž categories.json åŠ è½½åˆ†ç±»é…ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®")}},mergeUnknownCategories:function(n){const s={},c={};let u=!1;n.forEach(t=>{t.category1&&!a[t.category1]&&(a[t.category1]=[],s[t.category1]="ðŸ“¦",c[t.category1]="#74B9FF",u=!0),t.category1&&t.category2&&a[t.category1]&&(a[t.category1].includes(t.category2)||a[t.category1].push(t.category2))}),u&&(r={...t,...s},o={...e,...c})},isCategoriesLoaded:function(){return s},loadFromFiles:async function(t){const e=[];for(const n of t)try{const t=await n.text(),a=JSON.parse(t);a.expenses&&Array.isArray(a.expenses)&&a.expenses.forEach(t=>{t.type||(t.type=c(t.amount)),e.push(t)})}catch(t){console.error(`è¯»å–æ–‡ä»¶ ${n.name} å¤±è´¥:`,t)}return n=e.sort((t,e)=>new Date(e.date)-new Date(t.date)),n},getExpenses:function(){return n},addExpense:function(t){const e={id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}),date:t.date,amount:parseFloat(t.amount),category1:t.category1,category2:t.category2||"",remark:t.remark||""};return n.unshift(e),n.sort((t,e)=>new Date(e.date)-new Date(t.date)),e},updateExpense:function(t,e){const a=n.findIndex(e=>e.id===t);return-1===a?null:(n[a]={...n[a],...e},n.sort((t,e)=>new Date(e.date)-new Date(t.date)),n[a])},deleteExpense:function(t){const e=n.findIndex(e=>e.id===t);return-1!==e&&(n.splice(e,1),!0)},filterByDateRange:function(t,e,n){return e||n?t.filter(t=>{const a=new Date(t.date);return!(e&&a<e)&&!(n&&a>n)}):t},filterByCategories:function(t,e){return e&&0!==e.length?t.filter(t=>e.includes(t.category1)):t},calculateStats:u,calculateMoMStats:function(t,e,n,a){let r,o;switch(parseInt(a),e){case"month":const[t,e]=n.split("-").map(Number);r={start:new Date(t,e-1,1),end:new Date(t,e,0)},o={start:new Date(t,e-2,1),end:new Date(t,e-1,0)};break;case"year":const a=parseInt(n);r={start:new Date(a,0,1),end:new Date(a,11,31)},o={start:new Date(a-1,0,1),end:new Date(a-1,11,31)};break;case"quarter":const[s,c]=n.split("-Q").map(t=>parseInt(t.replace("Q",""))),u=3*(c-1);r={start:new Date(s,u,1),end:new Date(s,u+3,0)};const i=1===c?s-1:s,d=3*((1===c?4:c-1)-1);o={start:new Date(i,d,1),end:new Date(i,d+3,0)};break;case"week":const[l,f]=n.split("-W").map(t=>parseInt(t.replace("W","")));r=g(l,f),o=g(l,f-1);break;default:return null}const s=t.filter(t=>{const e=new Date(t.date);return e>=r.start&&e<=r.end}),c=t.filter(t=>{const e=new Date(t.date);return e>=o.start&&e<=o.end});return{current:u(s),previous:u(c)}},getMonthlyStats:function(t){const e={};return t.forEach(t=>{const n=t.date.substring(0,7);e[n]||(e[n]={expense:0,income:0}),t.amount<0?e[n].expense+=Math.abs(t.amount):e[n].income+=t.amount}),e},getTrendStats:function(t,e){const n={};return t.forEach(t=>{let a;const r=new Date(t.date);switch(e){case"year":a=t.date.substring(0,4);break;case"quarter":const e=Math.ceil((r.getMonth()+1)/3);a=`${t.date.substring(0,4)}-Q${e}`;break;case"week":const n=i(r);a=`${t.date.substring(0,4)}-W${n}`;break;default:a=t.date.substring(0,7)}n[a]||(n[a]={expense:0,income:0});const o=t.type;"expense"===o?n[a].expense+=Math.abs(t.amount):"income"===o&&(n[a].income+=t.amount)}),n},getCategoryStats:function(t){const e={};return t.forEach(t=>{"expense"===t.type&&(e[t.category1]||(e[t.category1]=0),e[t.category1]+=Math.abs(t.amount))}),e},getCategory2Stats:function(t,e){const n={};return t.forEach(t=>{if("expense"===t.type&&t.category1===e){const e=t.category2||"æœªåˆ†ç±»";n[e]||(n[e]=0),n[e]+=Math.abs(t.amount)}}),n},getCategory1List:function(){return Object.keys(a)},getCategory2List:function(t){return a[t]||[]},addCustomCategory:function(t,e=""){a[t]||(a[t]=[]),e&&!a[t].includes(e)&&a[t].push(e)},getCategoryIcon:function(t){return r[t]||"ðŸ“¦"},getCategoryColor:function(t){return o[t]||"#74B9FF"},getBillingPeriod:function(t,e=new Date){const n=e.getFullYear(),a=e.getMonth(),r=new Date(n,a-1,parseInt(t)+1),o=new Date(n,a,parseInt(t));return e.getDate()<parseInt(t)&&(r.setMonth(r.getMonth()-1),o.setMonth(o.getMonth()-1)),{start:r,end:o}},getAvailableYears:function(t){const e=new Set;return t.forEach(t=>{const n=t.date.substring(0,4);e.add(n)}),Array.from(e).sort().reverse()},getAvailableQuarters:function(t,e){const n=new Set;return t.forEach(t=>{if(t.date.startsWith(e)){const e=parseInt(t.date.substring(5,7)),a=Math.ceil(e/3);n.add(a)}}),Array.from(n).sort()},getAvailableMonths:function(t,e){const n=new Set;return t.forEach(t=>{t.date.startsWith(e)&&n.add(t.date.substring(5,7))}),Array.from(n).sort()},getAvailableWeeks:function(t,e){const n=new Set;return t.forEach(t=>{if(t.date.startsWith(e)){const e=i(new Date(t.date));n.add(e)}}),Array.from(n).sort((t,e)=>t-e)},calculatePeriodByDimension:function(t,e,n){const a=parseInt(n)||1;switch(t){case"year":return{start:new Date(e,0,1),end:new Date(e,11,31)};case"quarter":const[t,n]=e.split("-Q"),r=3*(parseInt(n)-1);return{start:new Date(t,r,1),end:new Date(t,r+3,0)};case"month":const[o,s]=e.split("-"),c=parseInt(s)-1,u=parseInt(o);let i=c+1,d=u;i>11&&(i=0,d=u+1);return{start:new Date(u,c,a),end:new Date(d,i,a-1)};case"week":const[l,f]=e.split("-W"),y=parseInt(f);return g(parseInt(l),y);default:return null}}}}();