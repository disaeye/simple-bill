<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>支出记账本</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Noto+Sans+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                    </svg>
                </div>
                <h1 class="title">支出记账本</h1>
            </div>
            <div class="header-right">
                <button class="btn btn-secondary" id="exportBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    <span>导出</span>
                </button>
                <button class="btn btn-secondary" id="importBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    <span>导入</span>
                </button>
                <button class="btn btn-secondary" id="selectDataBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                    </svg>
                    <span>本地目录</span>
                </button>
                <button class="btn btn-icon" id="refreshBtn" title="刷新数据">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6M1 20v-6h6"/>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Filter Bar (放在页面顶部) -->
        <section class="filter-bar">
            <div class="filter-bar-inner">
                <div class="filter-group-main">
                    <label class="filter-label">统计维度</label>
                    <select id="dimension" class="select-input filter-select-main">
                        <option value="month">按月</option>
                        <option value="year">按年</option>
                        <option value="quarter">按季度</option>
                        <option value="week">按周</option>
                        <option value="all">全部</option>
                    </select>
                </div>
                <div class="filter-group-main" id="billingDaySection">
                    <label class="filter-label">出账日</label>
                    <select id="billingDay" class="select-input filter-select-main">
                        <option value="1">1 日</option>
                        <option value="2">2 日</option>
                        <option value="3">3 日</option>
                        <option value="4">4 日</option>
                        <option value="5">5 日</option>
                        <option value="6">6 日</option>
                        <option value="7">7 日</option>
                        <option value="8">8 日</option>
                        <option value="9">9 日</option>
                        <option value="10">10 日</option>
                        <option value="11">11 日</option>
                        <option value="12">12 日</option>
                        <option value="13">13 日</option>
                        <option value="14">14 日</option>
                        <option value="15">15 日</option>
                        <option value="16">16 日</option>
                        <option value="17">17 日</option>
                        <option value="18">18 日</option>
                        <option value="19">19 日</option>
                        <option value="20">20 日</option>
                        <option value="21">21 日</option>
                        <option value="22">22 日</option>
                        <option value="23">23 日</option>
                        <option value="24">24 日</option>
                        <option value="25">25 日</option>
                        <option value="26">26 日</option>
                        <option value="27">27 日</option>
                        <option value="28">28 日</option>
                    </select>
                </div>
                <div class="filter-group-main" id="periodSection">
                    <label class="filter-label" id="periodTitle">选择月份</label>
                    <select id="periodSelect" class="select-input filter-select-main">
                        <!-- 动态生成选项 -->
                    </select>
                </div>
                <div class="filter-group-main">
                    <label class="filter-label">分类</label>
                    <select id="categoryFilter" class="select-input filter-select-main">
                        <option value="">全部</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Stats Cards -->
        <section class="stats-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon expense">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <span class="stat-label">总支出</span>
                        <span class="stat-value expense" id="totalExpense">¥0.00</span>
                        <span class="stat-change" id="totalExpenseChange"></span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon net">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <span class="stat-label">净支出</span>
                        <span class="stat-value" id="netExpense">¥0.00</span>
                        <span class="stat-change" id="netExpenseChange"></span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon refund">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="1 4 1 10 7 10"/>
                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <span class="stat-label">总退款</span>
                        <span class="stat-value refund" id="totalRefund">¥0.00</span>
                        <span class="stat-change" id="totalRefundChange"></span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon income">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 1 0 7h5a3.5 3.5 0 0 0 0 7H6"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <span class="stat-label">总收入</span>
                        <span class="stat-value income" id="totalIncome">¥0.00</span>
                        <span class="stat-change" id="totalIncomeChange"></span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Charts Section -->
        <section class="charts-section">
            <div class="charts-grid">
                <div class="chart-card">
                    <h3 class="chart-title" id="trendChartTitle">月度支出趋势</h3>
                    <div class="chart-container">
                        <div id="trendChart"></div>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">分类占比</h3>
                        <div class="category-back-btn hidden" id="categoryBackBtn">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 12H5M12 19l-7-7 7-7"/>
                            </svg>
                            <span>返回一级分类</span>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div id="categoryChart"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <section class="main-section">
            <!-- Expense List -->
            <main class="content">
                <div class="content-header">
                    <h2 class="content-title">支出明细</h2>
                    <div class="content-header-right">
                        <span class="record-count" id="recordCount">0 条记录</span>
                        <div class="pagination" id="pagination">
                            <button class="page-btn" id="prevPageBtn" disabled>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M15 18l-6-6 6-6"/>
                                </svg>
                            </button>
                            <span class="page-info" id="pageInfo">1 / 1</span>
                            <button class="page-btn" id="nextPageBtn" disabled>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 18l6-6-6-6"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="expense-list" id="expenseList">
                    <div class="empty-state" id="emptyState">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                        </svg>
                        <p>暂无数据</p>
                        <span>请先选择数据目录或添加支出记录</span>
                    </div>
                </div>
            </main>
        </section>

        <!-- Floating Action Button -->
        <button class="fab" id="addExpenseBtn" title="添加支出">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
        </button>
    </div>

    <!-- Modal -->
    <div class="modal-overlay hidden" id="modalOverlay">
        <div class="modal" id="expenseModal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">添加支出</h3>
                <button class="btn-close" id="closeModal">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <form class="modal-body" id="expenseForm">
                <input type="hidden" id="expenseId" />
                <div class="form-group">
                    <label class="form-label">日期</label>
                    <input type="date" id="expenseDate" class="input" required />
                </div>
                <div class="form-group">
                    <label class="form-label">金额</label>
                    <input type="number" id="expenseAmount" class="input" step="0.01" placeholder="负数表示退款" required />
                </div>
                <div class="form-group">
                    <label class="form-label">一级分类</label>
                    <select id="expenseCategory1" class="select-input" required>
                        <option value="">请选择</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">二级分类</label>
                    <select id="expenseCategory2" class="select-input">
                        <option value="">请选择</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">备注</label>
                    <input type="text" id="expenseRemark" class="input" placeholder="可选" />
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelBtn">取消</button>
                <button type="submit" class="btn btn-primary" id="saveBtn">保存</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast hidden" id="toast">
        <span class="toast-message" id="toastMessage"></span>
    </div>

    <!-- File Input (Hidden) -->
    <input type="file" id="directoryInput" webkitdirectory multiple style="display: none" />

    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gridjs@5.1.0/dist/gridjs.production.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gridjs/dist/theme/mermaid.min.css">
    <script src="js/data.js"></script>
    <script src="js/filter.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/chart.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
