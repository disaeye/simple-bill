# 支出记录与统计网站 - 规格文档

## 1. 项目概述

- **项目名称**: Expense Tracker (支出记账本)
- **项目类型**: 静态网站 (纯 HTML/CSS/JS)
- **核心功能**: 记录支出、分类管理、统计分析与可视化
- **目标用户**: 个人用户日常记账需求

## 2. UI/UX 规格

### 2.1 布局结构

```
┌─────────────────────────────────────────────────────────┐
│  Header: Logo + 标题 + 数据源配置按钮                   │
├─────────────────────────────────────────────────────────┤
│  Filter Bar: 统计维度 + 出账日 + 选择周期               │
├─────────────────────────────────────────────────────────┤
│  统计概览卡片区 (4列): 总支出 | 净支出 | 总退款 | 总收入│
├─────────────────────────────────────────────────────────┤
│  图表区: 月度趋势图 + 分类占比饼图                      │
├────────────────────────┬────────────────────────────────┤
│  侧边栏               │  主内容区                       │
│  - 分类筛选           │  - 支出列表 (表格形式)          │
│                      │  - 支持排序和筛选                │
│                      │  - 分页                         │
├────────────────────────┴────────────────────────────────┤
│  Footer: 添加支出按钮 (固定)                            │
└─────────────────────────────────────────────────────────�
```

- **响应式断点**:
  - Desktop: > 1024px (双列布局)
  - Tablet: 768px - 1024px (侧边栏折叠)
  - Mobile: < 768px (单列堆叠)

### 2.2 视觉设计

- **色彩方案** (温暖的大地色系):
  - 主色: `#2D3436` (深灰 - 文字/标题)
  - 次色: `#636E72` (中灰 - 次要文字)
  - 强调色: `#E17055` (珊瑚橙 - 支出/警示)
  - 收入色: `#00B894` (薄荷绿 - 收入/退款)
  - 背景色: `#FAFAFA` (浅灰白)
  - 卡片背景: `#FFFFFF`
  - 边框色: `#DFE6E9`
  - 分类色板: 预定义10种颜色用于图表

- **字体**:
  - 主字体: `"Noto Sans SC", "PingFang SC", "Microsoft YaHei", sans-serif`
  - 数字字体: `"JetBrains Mono", "SF Mono", monospace`
  - 标题: 24px (h1), 18px (h2), 16px (h3)
  - 正文: 14px
  - 小字: 12px

- **间距系统**:
  - 基础单位: 4px
  - 组件内边距: 16px
  - 卡片间距: 16px
  - 区块间距: 24px

- **视觉效果**:
  - 卡片阴影: `0 2px 8px rgba(0,0,0,0.08)`
  - 悬停阴影: `0 4px 16px rgba(0,0,0,0.12)`
  - 圆角: 12px (卡片), 8px (按钮/输入框)
  - 过渡动画: 0.2s ease

### 2.3 组件规格

#### 统计卡片
- 图标 + 数值 + 标签 + 环比变化
- 悬停时微微上浮 (transform: translateY(-2px))
- 4个卡片：总支出、净支出、总退款、总收入

#### 支出列表（表格形式）
- 列：日期、金额、交易类型、一级分类、二级分类、备注、操作
- 支持点击表头排序
- 支持多选筛选下拉框（交易类型、一级分类、二级分类）
- 表格筛选影响：统计卡片、图表、列表

#### 添加/编辑表单 (Modal)
- 日期选择器
- 金额输入 (支持负数，负数表示退款)
- 一级分类下拉 (可自定义)
- 二级分类下拉 (根据一级分类联动，可自定义)
- 备注输入框
- 保存/取消按钮

#### 图表
- 柱状图: 月度/年度/季度/周度支出趋势
  - 以当前选择的周期为中心，显示前后各4个周期的数据
- 饼图/环形图: 分类占比
  - 支持点击下钻到二级分类
  - 点击"返回一级分类"按钮返回上级
  - 最深只到二级分类
- 使用 ApexCharts 库

#### 筛选器
- 统计维度: 按月/按年/按季度/按周/全部
- 出账日: 1-28日
- 周期选择: 根据维度动态生成
- 侧边栏分类多选
- 表格内多选筛选（交易类型、一级分类、二级分类）

## 3. 功能规格

### 3.1 核心功能

#### 3.1.1 数据加载
- 支持从服务器 `/data/` 目录加载 `expenses.json`
- 支持用户点击"选择数据目录"按钮选择本地目录
- 使用 File System Access API 或文件选择器选择目录
- 读取目录下所有 `.json` 文件
- 合并所有数据，按日期排序
- 支持实时刷新

#### 3.1.2 数据格式
```json
{
  "expenses": [
    {
      "id": "uuid-string",
      "date": "2024-01-15",
      "amount": -150.00,
      "type": "expense",
      "category1": "餐饮",
      "category2": "午餐",
      "remark": "公司楼下的面馆"
    }
  ]
}
```

**type 字段说明**:
- `expense`: 支出（负数金额）
- `refund`: 退款（正数金额）
- `income`: 收入（正数金额）

#### 3.1.3 添加支出
- 点击底部悬浮按钮打开 Modal
- 填写表单后生成 UUID 保存
- 自动追加到当前加载的数据中
- 提示用户导出保存（本地模式）

#### 3.1.4 编辑支出
- 点击列表项编辑按钮进入编辑模式
- 修改后保存

#### 3.1.5 删除支出
- 点击删除按钮，确认后删除记录
- 提示用户导出保存（本地模式）

#### 3.1.6 统计功能
- **总支出**: type为expense的金额绝对值之和
- **总退款**: type为refund的金额之和
- **总收入**: type为income的金额之和
- **净支出**: 总支出 - 总退款
- **环比**: 显示当前周期与上一周期的对比变化的数值和百分比
   
#### 3.1.7 图表展示
- **月度支出趋势柱状图**: 根据选择的维度显示对应趋势
  - 以当前周期为中心，显示前后各4个周期
  - 支持按月/按年/按季度/按周
- **分类占比环形图**:
  - 一级分类占比
  - 点击进入二级分类
  - 支持返回一级分类

### 3.2 分类管理
- 预设常见一级分类: 餐饮、交通、购物、娱乐、教育、医疗、居住、通讯、投资、其他
- 预设常见二级分类
- 支持自定义添加分类
- 自动合并支出记录中的未知分类

### 3.3 账单周期
- 可设置账单日出账日 (默认每月1日)
- 按账单周期统计 (上月账单日出账日到本月账单日前一天)

## 4. 技术实现

### 4.1 文件结构
```
expense-tracker/
├── index.html          # 主页面
├── SPEC.md             # 规格文档
├── css/
│   └── style.css      # 样式文件
├── js/
│   ├── app.js         # 主逻辑
│   ├── data.js        # 数据处理
│   ├── chart.js       # 图表渲染 (ApexCharts)
│   └── ui.js          # UI组件
└── data/              # 数据目录
    ├── categories.json # 分类配置
    └── expenses.json  # 支出数据
```

### 4.2 依赖
- ApexCharts (CDN): 图表绘制
- Google Fonts: 字体 (Noto Sans SC, JetBrains Mono)

### 4.3 浏览器兼容性
- Chrome 86+
- Firefox 86+
- Safari 14+
- Edge 86+

## 5. 验收标准

### 功能验收
- [x] 能选择本地数据目录并加载 JSON 文件
- [x] 能正确显示所有支出的列表（表格形式）
- [x] 能添加新的支出记录
- [x] 能编辑已有的支出记录
- [x] 能删除支出记录
- [x] 统计卡片显示正确的汇总数据（总支出、净支出、总退款、总收入）
- [x] 环比变化显示正确
- [x] 月度趋势图正确显示（前后各4个周期）
- [x] 分类占比图正确显示
- [x] 分类占比图支持点击下钻到二级分类
- [x] 分类占比图支持返回一级分类
- [x] 侧边栏分类筛选功能正常
- [x] 时间维度筛选功能正常
- [x] 表格交易类型排序功能正常
- [x] 表格多选筛选功能正常（交易类型、一级分类、二级分类）
- [x] 表格筛选影响统计卡片、图表、列表

### UI验收
- [x] 页面布局与设计一致
- [x] 色彩符合规格定义
- [x] 响应式布局在不同屏幕尺寸下正常显示
- [x] 动画过渡流畅
- [x] 表单验证提示清晰
